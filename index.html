<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>fcAI – Colorful Custom Hand AI Project</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ===== TensorFlow / COCO-SSD ===== -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<style>
/* ===== Global ===== */
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: Arial, sans-serif;
}

/* ===== Header ===== */
#topHeader {
  background: #222;
  padding: 8px 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
#topHeader h1 {
  font-size: 18px;
  margin: 0;
}
#languageLabel {
  font-size: 12px;
  color: #aaa;
}

/* ===== Menu ===== */
#menuWrapper { position: relative; }
#menuToggle {
  font-size: 20px;
  background: #444;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
}
#menuPanel {
  position: absolute;
  right: 0;
  top: 36px;
  background: #333;
  border: 1px solid #555;
  border-radius: 8px;
  padding: 10px;
  width: 220px;
}
.hidden { display: none; }

/* ===== Video ===== */
#videoWrapper {
  position: relative;
  max-width: 420px;
  margin: 10px auto;
}
#video {
  width: 100%;
  background: #000;
  border-radius: 10px;
}
#bboxCanvas {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

/* ===== Hand SVG ===== */
#overlaySvg {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
.hand-svg { display: none; }
.hand-svg.active { display: block; }

.palm-line { stroke: #fff; stroke-width: 3; fill: none; }
.wrist-line { stroke: #fff; stroke-width: 4; }
.finger { stroke: #ff0; stroke-width: 3; }
.finger-joint { fill: #000; stroke: #ff0; stroke-width: 3; }

.hand-svg.locked .finger,
.hand-svg.locked .finger-joint {
  stroke-width: 6;
}

.phone-body { fill: #00f; }
.pen-body { stroke: #0f0; stroke-width: 4; }
.key-body { fill: #0cf; }

/* ===== UI ===== */
#resultArea { text-align: center; margin-top: 6px; }
#status { color: #ccc; font-size: 13px; }

#controlPanel {
  text-align: center;
  margin-top: 8px;
}
.sim-btn {
  width: 60px;
  height: 50px;
  margin: 4px;
}
</style>
</head>

<body>

<header id="topHeader">
  <div>
    <h1>fcAI</h1>
    <div id="languageLabel">Display language: English</div>
  </div>
  <div id="menuWrapper">
    <button id="menuToggle">≡</button>
    <div id="menuPanel" class="hidden">
      <div>
        Camera:
        <select id="cameraSelect">
          <option value="front">Front</option>
          <option value="back">Back</option>
        </select>
      </div>
      <div>
        Freeze:
        <input type="range" id="freezeSlider" min="2" max="10" value="3">
        <span id="freezeValue">3 sec</span>
      </div>
    </div>
  </div>
</header>

<div id="videoWrapper">
  <video id="video" autoplay playsinline></video>
  <canvas id="bboxCanvas"></canvas>

  <!-- === Hand Overlay (PHONE finger fixed) === -->
  <svg id="overlaySvg" viewBox="0 0 220 220">
    <g id="handRelaxed" class="hand-svg active">
      <rect x="80" y="90" width="60" height="70" rx="20" class="palm-line"/>
      <line x1="100" y1="160" x2="100" y2="188" class="wrist-line"/>
      <line x1="120" y1="160" x2="120" y2="188" class="wrist-line"/>
    </g>

    <g id="handPhone" class="hand-svg">
      <rect x="92" y="60" width="50" height="90" rx="8" class="phone-body"/>
      <rect x="80" y="95" width="60" height="65" rx="20" class="palm-line"/>
      <line x1="100" y1="160" x2="100" y2="188" class="wrist-line"/>
      <line x1="120" y1="160" x2="120" y2="188" class="wrist-line"/>

      <!-- FIXED floating finger -->
      <line x1="90" y1="120" x2="90" y2="100" class="finger"/>
      <circle cx="90" cy="120" r="4" class="finger-joint"/>
      <circle cx="90" cy="100" r="4" class="finger-joint"/>
    </g>

    <g id="handKey" class="hand-svg">
      <rect x="80" y="95" width="60" height="65" rx="20" class="palm-line"/>
      <line x1="100" y1="160" x2="100" y2="188" class="wrist-line"/>
      <line x1="120" y1="160" x2="120" y2="188" class="wrist-line"/>
      <rect x="60" y="112" width="26" height="4" class="key-body"/>
      <rect x="86" y="105" width="20" height="18" rx="9" class="key-body"/>
    </g>
  </svg>
</div>

<div id="resultArea">
  <div id="result">State: RELAXED</div>
  <div id="status">Tap Start Camera</div>
</div>

<div id="controlPanel">
  <button id="simPhone" class="sim-btn">Phone</button>
  <button id="simKey" class="sim-btn">Key</button>
  <button id="lockBtn">Lock</button>
  <button id="relaxBtn">Relax</button>
  <br>
  <button id="startCameraBtn">Start Camera</button>
</div>

<script>
/* ========= JS ========= */
const video = document.getElementById('video');
const canvas = document.getElementById('bboxCanvas');
const ctx = canvas.getContext('2d');

const handRelaxed = document.getElementById('handRelaxed');
const handPhone = document.getElementById('handPhone');
const handKey = document.getElementById('handKey');
const hands = [handRelaxed, handPhone, handKey];

let model, stream;
let lockActive = false;
let freezeUntil = 0;

function activateHand(h) {
  hands.forEach(x => x.classList.remove('active'));
  h.classList.add('active');
}

async function startCamera() {
  model = await cocoSsd.load();
  stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
  video.onloadedmetadata = () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    detect();
  };
}

async function detect() {
  if (lockActive || performance.now() < freezeUntil) {
    requestAnimationFrame(detect);
    return;
  }
  const preds = await model.detect(video);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  preds.forEach(p => {
    ctx.strokeStyle = '#00f';
    ctx.lineWidth = 3;
    ctx.strokeRect(...p.bbox);
    if (p.class === 'cell phone') activateHand(handPhone);
  });
  requestAnimationFrame(detect);
}

document.getElementById('startCameraBtn').onclick = startCamera;
document.getElementById('lockBtn').onclick = () => lockActive = true;
document.getElementById('relaxBtn').onclick = () => {
  lockActive = false;
  activateHand(handRelaxed);
};
</script>

</body>
</html>
